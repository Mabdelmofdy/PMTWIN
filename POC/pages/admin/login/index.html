<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - PMTwin</title>
    <link rel="stylesheet" href="../../../assets/css/main.css">
    <style>
        .admin-login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
            padding: 2rem;
        }
        
        .admin-login-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            padding: 3rem;
            max-width: 450px;
            width: 100%;
        }
        
        .admin-login-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .admin-login-header h1 {
            color: var(--color-primary);
            margin-bottom: 0.5rem;
        }
        
        .admin-login-header p {
            color: var(--text-secondary);
        }
        
        .admin-badge {
            display: inline-block;
            background: var(--color-primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="admin-login-container">
        <div class="admin-login-card">
            <div class="admin-login-header">
                <span class="admin-badge">ADMIN PORTAL</span>
                <h1>Admin Login</h1>
                <p>Access the PMTwin administration portal</p>
            </div>
            
            <div class="card" style="box-shadow: none; border: 1px solid var(--border-color);">
                <div class="card-body">
                    <form id="adminLoginForm">
                        <div class="form-group">
                            <label for="adminEmail" class="form-label">Email</label>
                            <input type="email" id="adminEmail" class="form-control" placeholder="admin@pmtwin.com" required autofocus>
                        </div>
                        
                        <div class="form-group">
                            <label for="adminPassword" class="form-label">Password</label>
                            <input type="password" id="adminPassword" class="form-control" placeholder="Enter your password" required>
                        </div>
                        
                        <div id="adminLoginError" class="alert alert-error" style="display: none; margin-bottom: 1rem;"></div>
                        
                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                            <i class="ph ph-sign-in"></i> Login to Admin Portal
                        </button>
                        
                        <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                            <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 0.5rem;">
                                Don't have admin access?
                            </p>
                            <a href="../../auth/login/" class="btn btn-secondary" style="width: 100%;">
                                <i class="ph ph-arrow-left"></i> Go to User Login
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            
            <div style="margin-top: 2rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0;">
                    <strong>Demo Admin Credentials:</strong><br>
                    Email: <code>admin@pmtwin.com</code><br>
                    Password: <code>Admin123</code>
                </p>
            </div>
        </div>
    </div>

    <!-- Configuration (must load first) -->
    <script src="../../../src/config/config.js"></script>
    
    <!-- API Layer -->
    <script src="../../../src/core/api/api-client.js"></script>
    <script src="../../../src/core/api/api-service.js"></script>
    
    <!-- Core Scripts -->
    <script src="../../../src/core/data/data.js"></script>
    <script src="../../../src/core/auth/auth.js"></script>
    <script src="../../../src/core/auth/auth-check.js"></script>
    <script src="../../../src/utils/demo-credentials.js"></script>
    <script src="../../../src/services/services-loader.js"></script>
    <script src="../../../data/data-loader.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Check if already logged in as admin
            if (typeof AuthCheck !== 'undefined') {
                const isAuth = await AuthCheck.checkAuth({ requireAuth: false });
                if (isAuth) {
                    const currentUser = Auth.getCurrentUser();
                    if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'platform_admin')) {
                        window.location.href = '../';
                        return;
                    }
                }
            }
            
            // Setup login form
            const loginForm = document.getElementById('adminLoginForm');
            const errorDiv = document.getElementById('adminLoginError');
            
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('adminEmail').value.trim();
                const password = document.getElementById('adminPassword').value;
                
                // Clear previous errors
                errorDiv.style.display = 'none';
                errorDiv.textContent = '';
                
                if (!email || !password) {
                    showError('Please enter both email and password');
                    return;
                }
                
                try {
                    // Try to login
                    let result;
                    if (typeof AuthService !== 'undefined') {
                        result = await AuthService.login(email, password);
                    } else if (typeof PMTwinAuth !== 'undefined') {
                        result = await PMTwinAuth.login(email, password);
                    } else {
                        showError('Authentication service not available. Please refresh the page.');
                        return;
                    }
                    
                    if (result.success) {
                        const user = result.user || Auth.getCurrentUser();
                        
                        // Check if user is admin
                        if (user && (user.role === 'admin' || user.role === 'platform_admin')) {
                            // Redirect to admin dashboard
                            window.location.href = '../';
                        } else {
                            showError('Access denied. This account does not have admin privileges.');
                            // Logout the non-admin user
                            if (typeof PMTwinAuth !== 'undefined') {
                                PMTwinAuth.logout();
                            }
                        }
                    } else {
                        showError(result.error || 'Login failed. Please check your credentials.');
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    showError('An error occurred during login. Please try again.');
                }
            });
            
            function showError(message) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
            }
            
            // Auto-fill demo credentials if available
            if (typeof PMTwinData !== 'undefined') {
                const adminUser = PMTwinData.Users.getByEmail('admin@pmtwin.com');
                if (adminUser) {
                    document.getElementById('adminEmail').value = 'admin@pmtwin.com';
                }
            }
        });
    </script>
</body>
</html>

